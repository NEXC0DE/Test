(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{wKyo:function(e,t,o){"use strict";o.r(t),o.d(t,"_frontmatter",(function(){return i})),o.d(t,"default",(function(){return d}));o("91GP"),o("rGqo"),o("yt8O"),o("Btvt"),o("RW0V"),o("q1tI");var a=o("7ljp"),n=o("013z");o("qKvR");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e}).apply(this,arguments)}var l,i={},c=(l="PageDescription",function(e){return console.warn("Component "+l+" was not imported, exported, or provided by MDXProvider as global scope"),Object(a.b)("div",e)}),p={_frontmatter:i},b=n.a;function d(e){var t=e.components,o=function(e,t){if(null==e)return{};var o,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,["components"]);return Object(a.b)(b,r({},p,o,{components:t,mdxType:"MDXLayout"}),Object(a.b)(c,{mdxType:"PageDescription"},Object(a.b)("p",null,"If any known issues exist or migration paths are needed to upgrade from one version of the DataPower Operator to another, they will be documented here.")),Object(a.b)("h1",null,"1.1.0"),Object(a.b)("h2",null,"Operator lock not released after Leader Pod removed"),Object(a.b)("h3",null,"Symptoms"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Immediately following an upgrade from 1.0.X to 1.1.X, you may see the following error when attempting to interact with a DataPowerService CR:",Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",r({parentName:"pre"},{}),'Error from server: conversion webhook for datapower.ibm.com/v1beta1, Kind=DataPowerService failed: Post https://changeme.default.svc:443/?timeout=30s: service "changeme" not found\n'))),Object(a.b)("li",{parentName:"ul"},"Failure to reconcile changes made to a DataPowerService CR after a failover event caused the previous DataPower Operator Leader Pod to be rescheduled.")),Object(a.b)("h3",null,"Description"),Object(a.b)("p",null,"Occasionally, when the DataPower Operator Leader Pod is removed, the new DataPower Operator Pod will show as being Ready but isn’t doing anything. In the logs you might see"),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{}),'{"level":"info","ts":"2020-09-08T19:29:53.432Z","logger":"leader","msg":"Not the leader. Waiting."}\n{"level":"info","ts":"2020-09-08T19:29:57.971Z","logger":"leader","msg":"Leader pod has been deleted, waiting for garbage collection do remove the lock."}\n')),Object(a.b)("p",null,"followed by additional waiting. In this case, Kubernetes’ garbage collection failed to clean up the ",Object(a.b)("inlineCode",{parentName:"p"},"datapower-operator-lock")," after the old Leader Pod was removed. This stops the new DataPower Operator Pod from completing initialization tasks such as creating the conversion webhook."),Object(a.b)("h3",null,"Solution"),Object(a.b)("p",null,"To resolve this issue, you must manually remove the lock resource. This can be done with"),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{}),"kubectl delete cm datapower-operator-lock\n")),Object(a.b)("p",null,"Once the lock is removed, the new DataPower Operator pod will begin its initialization."),Object(a.b)("h1",null,"1.0.1"),Object(a.b)("h2",null,"Invalid value for ",Object(a.b)("inlineCode",{parentName:"h2"},"spec.selector")),Object(a.b)("p",null,"When attempting to ugprade from ",Object(a.b)("inlineCode",{parentName:"p"},"1.0.0")," to ",Object(a.b)("inlineCode",{parentName:"p"},"1.0.1")," through the Operator Lifecycle Manager, an error will likely be seen that the ",Object(a.b)("inlineCode",{parentName:"p"},"installPlan")," failed."),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{}),'install strategy failed: Deployment.apps "datapower-operator" is invalid: spec.selector: Invalid value: v1.LabelSelector{...}, MatchExpressions:[]v1.LabelSelectorRequirement(nil)}: field is immutable\n')),Object(a.b)("p",null,"This error occurs because between version ",Object(a.b)("inlineCode",{parentName:"p"},"1.0.0")," and ",Object(a.b)("inlineCode",{parentName:"p"},"1.0.1")," a new ",Object(a.b)("inlineCode",{parentName:"p"},"label")," was added to the DataPower Operator Deployment resource to fix an issue related to operator-metrics. However, the install plan is not able to resolve this update because the LabelSelector is an immutable field."),Object(a.b)("h3",null,"Resolution"),Object(a.b)("p",null,"To workaround this issue, you can manually delete the existing ",Object(a.b)("inlineCode",{parentName:"p"},"datapower-operator")," Deployment resource. The Operator Lifecycle Manager should then recreate the ",Object(a.b)("inlineCode",{parentName:"p"},"datapower-operator")," Deployment resource with the ",Object(a.b)("inlineCode",{parentName:"p"},"1.0.1")," spec, and the install plan should succeed."),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{}),"oc delete deployment datapower-operator\n")),Object(a.b)("p",null,"Once done, validate a new ",Object(a.b)("inlineCode",{parentName:"p"},"datapower-operator")," Deployment is created:"),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{}),"oc get deployment\n")),Object(a.b)("p",null,"Then validate the ",Object(a.b)("inlineCode",{parentName:"p"},"1.0.1")," install plan succeeds by checking the ",Object(a.b)("inlineCode",{parentName:"p"},"ClusterServiceVersion")," resource:"),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{}),"$ oc get csv\nNAME                        DISPLAY                 VERSION   REPLACES                    PHASE\ndatapower-operator.v1.0.1   IBM DataPower Gateway   1.0.1     datapower-operator.v1.0.0   Succeeded\n")))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-troubleshooting-operator-upgrades-mdx-3ea459f484a3036ef4e3.js.map