{"componentChunkName":"component---src-pages-troubleshooting-operator-lock-mdx","path":"/troubleshooting/operator-lock/","result":{"pageContext":{"frontmatter":{"title":"Operator lock not removed","description":"Troubleshooting guide related to DataPower Operator lock removal"},"relativePagePath":"/troubleshooting/operator-lock.mdx","titleType":"page","MdxNode":{"id":"60ddf54c-00fa-594e-9a43-e649e9934c1e","children":[],"parent":"c7d29b42-65c9-5212-bfcc-e1fbbbb685fa","internal":{"content":"---\ntitle: Operator lock not removed\ndescription: Troubleshooting guide related to DataPower Operator lock removal\n---\n\n## Background\n\nThe DataPower Operator uses leader-for-life [leader election](https://docs.openshift.com/container-platform/4.6/operators/operator_sdk/osdk-leader-election.html) to ensure only one controller pod is active at a time. This relies on Kubernetes garbage collection to clean up the lock when the old operator pod is deleted.\n\n## Issue\n\nWhen Kubernetes garbage collection is slow, this can lead to an extended period of time in which the new operator pod is not able to obtain the lock, thus preventing it from becoming active and reconciling resources.\n\n## Symptoms\n\nLogs from the `datapower-operator` pod will show that the pod is waiting for the lock to be removed:\n\n```\n{\"level\":\"info\",\"ts\":\"2021-03-08T19:29:53.432Z\",\"logger\":\"leader\",\"msg\":\"Not the leader. Waiting.\"}\n{\"level\":\"info\",\"ts\":\"2021-03-08T19:29:57.971Z\",\"logger\":\"leader\",\"msg\":\"Leader pod has been deleted, waiting for garbage collection to remove the lock.\"}\n```\n\n## Solution\n\nTo resolve this issue, you must manually remove the lock. This can be done by deleting the `datapower-operator-lock` ConfigMap in the namespace of the DataPower Operator pod.\n\n```\nkubectl delete cm datapower-operator-lock\n```\n\nOnce the lock is removed, the new DataPower Operator pod will begin operation. This can be verified by checking the logs from the operator pod:\n\n```\n{\"level\":\"info\",\"ts\":\"2021-03-08T20:16:29.974Z\",\"logger\":\"leader\",\"msg\":\"No pre-existing lock was found.\"}\n{\"level\":\"info\",\"ts\":\"2021-03-08T20:16:30.008Z\",\"logger\":\"leader\",\"msg\":\"Became the leader.\"}\n```","type":"Mdx","contentDigest":"3f3d0e582fad05c9b9182d650a7d1a67","counter":141,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Operator lock not removed","description":"Troubleshooting guide related to DataPower Operator lock removal"},"exports":{},"rawBody":"---\ntitle: Operator lock not removed\ndescription: Troubleshooting guide related to DataPower Operator lock removal\n---\n\n## Background\n\nThe DataPower Operator uses leader-for-life [leader election](https://docs.openshift.com/container-platform/4.6/operators/operator_sdk/osdk-leader-election.html) to ensure only one controller pod is active at a time. This relies on Kubernetes garbage collection to clean up the lock when the old operator pod is deleted.\n\n## Issue\n\nWhen Kubernetes garbage collection is slow, this can lead to an extended period of time in which the new operator pod is not able to obtain the lock, thus preventing it from becoming active and reconciling resources.\n\n## Symptoms\n\nLogs from the `datapower-operator` pod will show that the pod is waiting for the lock to be removed:\n\n```\n{\"level\":\"info\",\"ts\":\"2021-03-08T19:29:53.432Z\",\"logger\":\"leader\",\"msg\":\"Not the leader. Waiting.\"}\n{\"level\":\"info\",\"ts\":\"2021-03-08T19:29:57.971Z\",\"logger\":\"leader\",\"msg\":\"Leader pod has been deleted, waiting for garbage collection to remove the lock.\"}\n```\n\n## Solution\n\nTo resolve this issue, you must manually remove the lock. This can be done by deleting the `datapower-operator-lock` ConfigMap in the namespace of the DataPower Operator pod.\n\n```\nkubectl delete cm datapower-operator-lock\n```\n\nOnce the lock is removed, the new DataPower Operator pod will begin operation. This can be verified by checking the logs from the operator pod:\n\n```\n{\"level\":\"info\",\"ts\":\"2021-03-08T20:16:29.974Z\",\"logger\":\"leader\",\"msg\":\"No pre-existing lock was found.\"}\n{\"level\":\"info\",\"ts\":\"2021-03-08T20:16:30.008Z\",\"logger\":\"leader\",\"msg\":\"Became the leader.\"}\n```","fileAbsolutePath":"/home/travis/build/IBM/datapower-operator-doc/src/pages/troubleshooting/operator-lock.mdx"}}}}