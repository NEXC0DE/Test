(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{u8Uq:function(e,a,t){"use strict";t.r(a),t.d(a,"_frontmatter",(function(){return p})),t.d(a,"default",(function(){return O}));t("91GP"),t("rGqo"),t("yt8O"),t("Btvt"),t("RW0V"),t("q1tI");var n=t("7ljp"),r=t("013z"),i=t("Wbzz");t("qKvR");function o(){return(o=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var p={},c=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(n.b)("div",a)}},l=c("PageDescription"),b=c("AnchorLinks"),s=c("AnchorLink"),m=c("InlineNotification"),d={_frontmatter:p},u=r.a;function O(e){var a=e.components,t=function(e,a){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,["components"]);return Object(n.b)(u,o({},d,t,{components:a,mdxType:"MDXLayout"}),Object(n.b)(l,{mdxType:"PageDescription"},Object(n.b)("p",null,"This guide provides steps to migrate an existing IBM DataPower Gateway (physical / virtual) to a container-based deployment utilizing the IBM DataPower Operator.")),Object(n.b)("h2",null,"Prepare for your migration"),Object(n.b)("p",null,"This guide assumes that you have already installed IBM DataPower Operator; if you have not, see ",Object(n.b)("a",o({parentName:"p"},{href:"/datapower-operator-doc/getting-started"}),"Getting Started"),"."),Object(n.b)("p",null,"Additionally, ensure that you have:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"working knowledge of our latest ",Object(n.b)("a",o({parentName:"li"},{href:"/datapower-operator-doc/apis/datapowerservice/v1beta3"}),Object(n.b)("inlineCode",{parentName:"a"},"DataPowerService"))," API version (",Object(n.b)("inlineCode",{parentName:"li"},"v1beta3"),")"),Object(n.b)("li",{parentName:"ul"},"familiarity with ",Object(n.b)("a",o({parentName:"li"},{href:"/datapower-operator-doc/guides/domain-configuration"}),"Domain configuration"))),Object(n.b)("h2",null,"Migrate"),Object(n.b)("h3",null,"Overview"),Object(n.b)("p",null,"Follow the steps below to migrate your IBM DataPower Gateway to an IBM DataPower Operator managed deployment:"),Object(n.b)(b,{small:!0,mdxType:"AnchorLinks"},Object(n.b)(s,{mdxType:"AnchorLink"},"Backing up your existing IBM DataPower Gateway deployment"),Object(n.b)(s,{mdxType:"AnchorLink"},"Generating ConfigMap YAMLs for application domains"),Object(n.b)(s,{mdxType:"AnchorLink"},"Creating ConfigMaps in your Kuberetes / OpenShift cluster"),Object(n.b)(s,{mdxType:"AnchorLink"},"Creating Secrets in your Kubernetes / OpenShift cluster"),Object(n.b)(s,{mdxType:"AnchorLink"},"Creating an admin user credential"),Object(n.b)(s,{mdxType:"AnchorLink"},"Building the DataPowerService resource spec"),Object(n.b)(s,{mdxType:"AnchorLink"},"Deploying the DataPowerService resource")),Object(n.b)("h3",null,"Backing up your existing IBM DataPower Gateway deployment"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},"Log in to your existing IBM DataPower Gateway WebGUI as the ",Object(n.b)("inlineCode",{parentName:"li"},"admin")," user."),Object(n.b)("li",{parentName:"ol"},"From the ",Object(n.b)("inlineCode",{parentName:"li"},"default")," domain, select ",Object(n.b)("strong",{parentName:"li"},"Export Configration")," in the Control Panel."),Object(n.b)("li",{parentName:"ol"},"Select either ",Object(n.b)("strong",{parentName:"li"},"Create a backup of one or more application domains")," or ",Object(n.b)("strong",{parentName:"li"},"Create a backup of the entire system"),", depending on how many domains you intend to migrate."),Object(n.b)("li",{parentName:"ol"},"Follow the system prompts."),Object(n.b)("li",{parentName:"ol"},"Once complete, download the backup ZIP.")),Object(n.b)("h3",null,"Generating ConfigMap YAMLs for application domains"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Download the ",Object(n.b)("a",o({parentName:"p"},{href:"https://github.com/IBM/datapower-operator-scripts#migrate-backupsh"}),Object(n.b)("inlineCode",{parentName:"a"},"migrate-backup.sh"))," script."),Object(n.b)("p",{parentName:"li"},"This script is designed to automatically generate the ConfigMaps for each application domain from an IBM DataPower Gateway backup:"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},"ConfigMap YAML for each domain ",Object(n.b)("inlineCode",{parentName:"li"},".cfg")," file"),Object(n.b)("li",{parentName:"ul"},"ConfigMap YAML for each domain’s ",Object(n.b)("inlineCode",{parentName:"li"},"local:///")," file system")),Object(n.b)("p",{parentName:"li"},"For details on the script’s invocation, see ",Object(n.b)("inlineCode",{parentName:"p"},"./migrate-backup.sh --help"),".")),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Run the script against your backup ZIP."),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"./migrate-backup.sh backup.zip\n")),Object(n.b)("p",{parentName:"li"},Object(n.b)("strong",{parentName:"p"},"Note:")," If you only wish to migrate a single domain, specify the ",Object(n.b)("inlineCode",{parentName:"p"},"-d")," or ",Object(n.b)("inlineCode",{parentName:"p"},"--domain")," argument. For example:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"./migrate-backup.sh --domain test backup.zip\n"))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Inspect the generated output for details on where output files are generated, for example,"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"YAML will be generated in: backup-output\n"))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Review the generated YAML files."),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},"Files ending in ",Object(n.b)("inlineCode",{parentName:"li"},"-cfg.yaml")," contain the domain’s configuration in ",Object(n.b)("inlineCode",{parentName:"li"},"cfg")," format."),Object(n.b)("li",{parentName:"ul"},"Files ending in ",Object(n.b)("inlineCode",{parentName:"li"},"-local.yaml")," contain the domain’s ",Object(n.b)("inlineCode",{parentName:"li"},"local:///")," file system, in ",Object(n.b)("inlineCode",{parentName:"li"},".tar.gz")," format.")),Object(n.b)("p",{parentName:"li"},"You apply the YAML (both formats) in the next step."))),Object(n.b)("h3",null,"Creating ConfigMaps in your Kuberetes / OpenShift cluster"),Object(n.b)("p",null,"In the appropriate Kubernetes namespace or OpenShift project, apply the generated YAML for each domain that you wish to migrate."),Object(n.b)(m,{mdxType:"InlineNotification"},Object(n.b)("p",null,"The below examples use ",Object(n.b)("inlineCode",{parentName:"p"},"oc")," CLI as example (for OpenShift), Kubernetes users should substitue ",Object(n.b)("inlineCode",{parentName:"p"},"kubectl")," where appropriate, and make sure to use ",Object(n.b)("inlineCode",{parentName:"p"},"-n namespace")," to specify the target namespace for resource creation.")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Note:")," These ConfigMaps will be used later in ",Object(n.b)("a",o({parentName:"p"},{href:"/datapower-operator-doc/migration/containers#building-the-datapowerservice-resource-spec"}),"Building the DataPowerService resource spec"),"."),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"(OpenShift only) Using your ",Object(n.b)("inlineCode",{parentName:"p"},"oc")," CLI, switch to the project (namespace) you wish to deploy the migrated IBM DataPower Gateway."),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"oc project <namespace>\n"))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Apply the generated YAML files. Be sure to apply all YAML files for each domain you wish to migrate."),Object(n.b)("p",{parentName:"li"},"Example of single domain with a ",Object(n.b)("inlineCode",{parentName:"p"},"cfg")," and ",Object(n.b)("inlineCode",{parentName:"p"},"local")," YAML each:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{className:"language-bash"}),"cd backup-output\noc apply -f domain-cfg.yaml\noc apply -f domain-local.yaml\n")),Object(n.b)("p",{parentName:"li"},"Example using bash scripting to apply all YAMLs from the backup at once:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{className:"language-bash"}),"for yaml in $(find backup-output -name '*.yaml'); do\n    oc apply -f $yaml\ndone\n"))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Once the YAML is applied, check the cluster to ensure that everything looks correct:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"oc get configmap\n")))),Object(n.b)("h3",null,"Creating Secrets in your Kubernetes / OpenShift cluster"),Object(n.b)("p",null,"The TLS keys and certificates used by your IBM DataPower Gateway services must be stored in Kubernetes Secrets."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Note:")," These Secrets will be used later in ",Object(n.b)("a",o({parentName:"p"},{href:"/datapower-operator-doc/migration/containers#building-the-datapowerservice-resource-spec"}),"Building the DataPowerService resource spec"),"."),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Gather the keys and certificates you wish to use."),Object(n.b)(m,{kind:"warning",mdxType:"InlineNotification"},Object(n.b)("p",{parentName:"li"},Object(n.b)("strong",{parentName:"p"},"Note:")," You cannot export the private keys from an existing physical or virtual appliance."))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"For each key/cert pair or set of crypto, create a Secret with an appropriate name to reference later:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"oc create secret tls <my-tls-secret> --key=/path/to/my.crt --cert=/path/to/my.key\n")),Object(n.b)("p",{parentName:"li"},"or for generic (non-TLS) crypto:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"oc create secret generic <my-crypto-secret> --from-file=/path/to/cert --from-file=/path/to/key\n")),Object(n.b)("p",{parentName:"li"},"Refer to the Kubernetes ",Object(n.b)("a",o({parentName:"p"},{href:"https://kubernetes.io/docs/concepts/configuration/secret/"}),"documentation")," for details on the differences among Secrets."))),Object(n.b)("h3",null,"Creating an admin user credential"),Object(n.b)("p",null,"Following security best-practices, the IBM DataPower Gateway ",Object(n.b)("inlineCode",{parentName:"p"},"admin")," user credentials are stored in a Kubernetes Secret."),Object(n.b)("p",null,"Create the Secret using ",Object(n.b)("inlineCode",{parentName:"p"},"oc")," (or ",Object(n.b)("inlineCode",{parentName:"p"},"kubectl")," for Kubernetes), specifying the password via CLI, and noting the name of the Secret as you will need this later:"),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{}),"oc create secret generic admin-credentials --from-literal=password=admin\n")),Object(n.b)("p",null,"Example: In the above command, ",Object(n.b)("inlineCode",{parentName:"p"},"admin-credentials")," is the name of the Secret, and ",Object(n.b)("inlineCode",{parentName:"p"},"admin")," is the password."),Object(n.b)("h3",null,"Building the DataPowerService resource spec"),Object(n.b)(m,{mdxType:"InlineNotification"},Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Recommended:")," Open our DataPowerService ",Object(n.b)("a",o({parentName:"p"},{href:"/datapower-operator-doc/apis/datapowerservice/v1beta3"}),"API docs")," for reference as you build your custom resource spec.")),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Open your editor of choice, and start with the following template:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{className:"language-yaml"}),"apiVersion: datapower.ibm.com/v1beta3\nkind: DataPowerService\nmetadata:\n  name: migration-example\nspec:\n  replicas: 1\n  version: 10.0-cd\n  license:\n    accept: true\n    use: production\n    license: L-RJON-BYDR3Q\n"))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Edit the ",Object(n.b)("inlineCode",{parentName:"p"},"spec.version")," and ",Object(n.b)("inlineCode",{parentName:"p"},"spec.license")," to choose your desired firmware version and edition."),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},"Refer to our ",Object(n.b)("a",o({parentName:"li"},{href:"/datapower-operator-doc/guides/licenses"}),"Licenses guide")," for appropriate values for ",Object(n.b)("inlineCode",{parentName:"li"},"spec.license.license")," and how they map to the ",Object(n.b)("inlineCode",{parentName:"li"},"spec.version")," and ",Object(n.b)("inlineCode",{parentName:"li"},"spec.license.use"),"."),Object(n.b)("li",{parentName:"ul"},"Refer to the ",Object(n.b)("a",o({parentName:"li"},{href:"/datapower-operator-doc/apis/datapowerservice/v1beta3#license"}),Object(n.b)("inlineCode",{parentName:"a"},"spec.license"))," and ",Object(n.b)("a",o({parentName:"li"},{href:"/datapower-operator-doc/apis/datapowerservice/v1beta3#version"}),Object(n.b)("inlineCode",{parentName:"a"},"spec.version"))," API docs for details on these fields.")))),Object(n.b)("ol",{start:3},Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Add a ",Object(n.b)("inlineCode",{parentName:"p"},"spec.users")," definition for your ",Object(n.b)("inlineCode",{parentName:"p"},"admin")," user, using the Secret name (",Object(n.b)("inlineCode",{parentName:"p"},"admin-credentials"),") created in the ",Object(n.b)("a",o({parentName:"p"},{href:"/datapower-operator-doc/migration/containers#creating-an-admin-user-credential"}),"Create an admin user credential")," step for the value of ",Object(n.b)("inlineCode",{parentName:"p"},"passwordSecret"),". See the ",Object(n.b)("a",o({parentName:"p"},{href:"/datapower-operator-doc/apis/datapowerservice/v1beta3#users"}),Object(n.b)("inlineCode",{parentName:"a"},"spec.users"))," API docs for details."),Object(n.b)("p",{parentName:"li"},"For example:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{className:"language-yaml"}),"users:\n- name: admin\n  accessLevel: privileged\n  passwordSecret: admin-credentials\n"))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Add a ",Object(n.b)("inlineCode",{parentName:"p"},"spec.domains")," definition, with an entry for each application domain you wish to deploy."),Object(n.b)("p",{parentName:"li"},"For reference, see the ",Object(n.b)("a",o({parentName:"p"},{href:"/datapower-operator-doc/guides/domain-configuration"}),"Domain configuration guide"),"."),Object(n.b)("p",{parentName:"li"},"As an example, let’s assume a domain name of ",Object(n.b)("inlineCode",{parentName:"p"},"example"),". Let’s also assume that we created ",Object(n.b)("inlineCode",{parentName:"p"},"example-cfg")," and ",Object(n.b)("inlineCode",{parentName:"p"},"example-local")," ConfigMaps for this domain, containing its configuration and ",Object(n.b)("inlineCode",{parentName:"p"},"local:///")," file system respectively. The ",Object(n.b)("inlineCode",{parentName:"p"},"spec.domains")," definition would be:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{className:"language-yaml"}),"domains:\n- name: example\n  dpApp:\n    config:\n    - example-cfg\n    local:\n    - example-local\n")),Object(n.b)("p",{parentName:"li"},"Next, update the domain object to include any ",Object(n.b)("a",o({parentName:"p"},{href:"/datapower-operator-doc/guides/domain-configuration#certs"}),"certs")," definitions, referencing the Secrets you created in an earlier step containg TLS or other crypto material."),Object(n.b)("p",{parentName:"li"},"As an example, let’s assume we created a Secret named ",Object(n.b)("inlineCode",{parentName:"p"},"example-service")," which contains a TLS key/cert pair for a service defined in this ",Object(n.b)("inlineCode",{parentName:"p"},"example")," application domain. The amended domains spec would be:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{className:"language-yaml"}),"domains:\n- name: example\n  certs:\n  - certType: usrcerts\n    secret: example-service\n  dpApp:\n    config:\n    - example-cfg\n    local:\n    - example-local\n")),Object(n.b)("p",{parentName:"li"},"Repeat the full procedure in this step for each application domain you wish to deploy.")),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"You should now have a complete DataPowerService definition. Putting the above examples together would give us:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{className:"language-yaml"}),"apiVersion: datapower.ibm.com/v1beta3\nkind: DataPowerService\nmetadata:\n  name: migration-example\nspec:\n  replicas: 1\n  version: 10.0-cd\n  license:\n    accept: true\n    use: production\n    license: L-RJON-BYDR3Q\n  users:\n  - name: admin\n    accessLevel: privileged\n    passwordSecret: admin-credentials\n  domains:\n  - name: example\n    certs:\n    - certType: usrcerts\n      secret: example-service\n    dpApp:\n      config:\n      - example-cfg\n      local:\n      - example-local\n"))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Save the YAML to a file of your choosing. For subsequent examples, we’ll use ",Object(n.b)("inlineCode",{parentName:"p"},"migration-example.yaml"),"."))),Object(n.b)("h3",null,"Deploying the DataPowerService resource"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Create the DataPowerService resource in the cluster."),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"oc apply -f migration-example.yaml\n")),Object(n.b)("p",{parentName:"li"},"For Kubernetes users, where ",Object(n.b)("inlineCode",{parentName:"p"},"namespace")," is your desired namespace:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"kubectl -n namespace -f migration-example.yaml\n"))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Check the status of the deployment to ensure successful migration."),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"# full view\noc get all\n\n# just the DataPowerService instance(s)\noc get dp\n")),Object(n.b)("p",{parentName:"li"},"For Kubernetes users:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{}),"# full view\nkubectl -n namespace get all\n\n# just the DataPowerService instance(s)\nkubectl -n namespace get dp\n")),Object(n.b)("p",{parentName:"li"},"Refer to our guide on ",Object(n.b)("a",o({parentName:"p"},{href:"/datapower-operator-doc/guides/operand-status"}),"operand status")," for more information.")),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"If the DataPowerService is operational and ",Object(n.b)("inlineCode",{parentName:"p"},"Ready"),", continue on to modernizing your IBM DataPower Gateway workloads."))),Object(n.b)("h2",null,"Modernize"),Object(n.b)("p",null,"Now that you have successfully migrated an existing IBM DataPower Gateway workload to Kubernetes / OpenShift leveraging the IBM DataPower Operator, you can begin leveraging features that modernize your deployment."),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Automatically scale your IBM DataPower Gateway pods horizontally or vertically using ",Object(n.b)("a",o({parentName:"li"},{href:"/datapower-operator-doc/features/pod-auto-scaling"}),"Pod Auto-Scaling"),"."),Object(n.b)("li",{parentName:"ul"},"Learn how the IBM DataPower Operator manages IBM DataPower Gateway upgrades in ",Object(n.b)("a",o({parentName:"li"},{href:"/datapower-operator-doc/features/operand-upgrade"}),"Operand Upgrades"),"."),Object(n.b)("li",{parentName:"ul"},"Fine-tune your topology and scheduling of IBM DataPower Gateway pods using ",Object(n.b)(i.Link,{to:"/apis/datapowerservice/v1beta3#affinity",mdxType:"Link"},"affinity"),", ",Object(n.b)(i.Link,{to:"/apis/datapowerservice/v1beta3#tolerations",mdxType:"Link"},"tolerations"),", and ",Object(n.b)(i.Link,{to:"/apis/datapowerservice/v1beta3#nodeselector",mdxType:"Link"},"nodeSelector")," properties in the ",Object(n.b)("inlineCode",{parentName:"li"},"DataPowerService")," custom resource."),Object(n.b)("li",{parentName:"ul"},"Check out our ",Object(n.b)("a",o({parentName:"li"},{href:"/datapower-operator-doc/release-notes/cd"}),"release notes")," for the latest details on features and changes within the IBM DataPower Operator.")))}O.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-migration-containers-mdx-4077f499c426cb1a81ea.js.map