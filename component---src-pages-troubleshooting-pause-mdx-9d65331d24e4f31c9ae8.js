(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{YbEE:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return r})),n.d(t,"default",(function(){return u}));n("91GP"),n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("q1tI");var a=n("7ljp"),i=n("013z");n("qKvR");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var r={},l=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(a.b)("div",t)}},c=l("PageDescription"),s=l("InlineNotification"),p={_frontmatter:r},b=i.a;function u(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,["components"]);return Object(a.b)(b,o({},p,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)(c,{mdxType:"PageDescription"},Object(a.b)("p",null,"The DataPower Operator’s reconciliation of the DataPower StatefulSet can be paused, allowing you to modify the StatefulSet directly for troubleshooting purposes.")),Object(a.b)("h2",null,"Background"),Object(a.b)("p",null,"While the ",Object(a.b)("inlineCode",{parentName:"p"},"DataPowerService")," CRD exposes a handful of helpful troubleshooting capabilities such as init script debugging and lifecycle hooks, there are cases where it’s necessary to modify the StatefulSet directly to troubleshoot an issue. This can lead to conflict with the DataPower Operator’s reconciliation of the StatefulSet, because any changes made to the StatefulSet directly can be overwritten by the operator."),Object(a.b)("h2",null,"Pausing reconciliation"),Object(a.b)("p",null,"To pause reconciliation of the ",Object(a.b)("inlineCode",{parentName:"p"},"DataPowerService")," custom resource, and the owned StatefulSet, an annotation can be added to the ",Object(a.b)("inlineCode",{parentName:"p"},"DataPowerService")," instance. There are two mechanisms supported: auto-expiring pause and indefinite pause."),Object(a.b)("p",null,"Both pause mechanisms use the same annotation key: ",Object(a.b)("inlineCode",{parentName:"p"},"datapower.ibm.com/pause"),". The difference in their behavior is determined by the value specified in the annotation."),Object(a.b)("h3",null,"Auto-expiring pause"),Object(a.b)("p",null,"Reconciliation can be paused for a duration of time, after which the pause will lift automatically. Once the time duration expires, the pause annotation is automatically removed by the operator and reconciliation of the StatefulSet will resume automatically."),Object(a.b)("p",null,"The syntax for specifying an auto-expiring pause is as follows:"),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-yaml"}),"apiVersion: datapower.ibm.com/v1beta3\nkind: DataPowerService\nmetadata:\n  annotations:\n    datapower.ibm.com/pause: <duration>\n")),Object(a.b)("p",null,"where ",Object(a.b)("inlineCode",{parentName:"p"},"<duration>")," is a sequence of decimal numbers with time unit suffix."),Object(a.b)("p",null,"Valid time units are ",Object(a.b)("inlineCode",{parentName:"p"},"s"),", ",Object(a.b)("inlineCode",{parentName:"p"},"m"),", ",Object(a.b)("inlineCode",{parentName:"p"},"h"),". Some examples:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"10m")," would pause for 10 minutes"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"120s")," would pause for 120 seconds"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"1h30m")," would pause for 1 hour 30 minutes")),Object(a.b)(s,{mdxType:"InlineNotification"},Object(a.b)("p",null,"The minimum duration that reconciliation can be paused is 1 minute.")),Object(a.b)("p",null,"Once the ",Object(a.b)("inlineCode",{parentName:"p"},"datapower.ibm.com/pause")," annotation is added, the operator will generate a second annotation that indicates the expiration timestamp. Below is an example of an instance that has been paused for 10 minutes, and has the ",Object(a.b)("inlineCode",{parentName:"p"},"pause-expiration")," timestamp added."),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-yaml"}),'apiVersion: datapower.ibm.com/v1beta3\nkind: DataPowerService\nmetadata:\n  annotations:\n    datapower.ibm.com/pause: 10m\n    datapower.ibm.com/pause-expiration: "2021-03-03T20:41:32Z"\n')),Object(a.b)(s,{mdxType:"InlineNotification"},Object(a.b)("p",null,"Note that once the ",Object(a.b)("inlineCode",{parentName:"p"},"pause-expiration")," timestamp passes, ",Object(a.b)("strong",{parentName:"p"},"both")," pause annotations are automatically removed by the operator.")),Object(a.b)("p",null,"During the time period that reconciliation is paused, a ",Object(a.b)("inlineCode",{parentName:"p"},"Warning")," condition will be raised on the ",Object(a.b)("inlineCode",{parentName:"p"},"DataPowerService")," instance, for example:"),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-yaml"}),'status:\n  conditions:\n  - lastTransitionTime: "2021-03-03T20:31:33Z"\n    message: Reconciliation is paused until 2021-03-03T20:41:32Z\n    reason: ReconcileWarning\n    status: "True"\n    type: Warning\n')),Object(a.b)("h3",null,"Indefinite pause"),Object(a.b)("p",null,"Reconciliation can be paused indefinitely, meaning that the user must manually remove the annotation to resume normal operation. Once the annotation is removed by the user, reconciliation of the StatefulSet resumes normally."),Object(a.b)("p",null,"The syntax for specifying an indefinite pause is as follows:"),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-yaml"}),'apiVersion: datapower.ibm.com/v1beta3\nkind: DataPowerService\nmetadata:\n  annotations:\n    datapower.ibm.com/pause: "true"\n')),Object(a.b)(s,{type:"warning",mdxType:"InlineNotification"},Object(a.b)("p",null,"The value ",Object(a.b)("strong",{parentName:"p"},"must")," be a string, i.e. ",Object(a.b)("inlineCode",{parentName:"p"},'"true"'),", just providing ",Object(a.b)("inlineCode",{parentName:"p"},"true")," will not work and you will receive an error when trying to apply the update.")),Object(a.b)("p",null,"Once this annotation is added, reconciliation will be paused indefinitely, until the annotation is removed by the user. During this time, a ",Object(a.b)("inlineCode",{parentName:"p"},"Warning")," condition will be raised on the ",Object(a.b)("inlineCode",{parentName:"p"},"DataPowerService")," instance indicating the status:"),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-yaml"}),'status:\n  conditions:\n  - lastTransitionTime: "2021-03-03T20:43:45Z"\n    message: Reconciliation is paused indefinitely\n    reason: ReconcileWarning\n    status: "True"\n    type: Warning\n')))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-troubleshooting-pause-mdx-9d65331d24e4f31c9ae8.js.map