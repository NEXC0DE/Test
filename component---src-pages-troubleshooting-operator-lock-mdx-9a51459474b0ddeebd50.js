(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{WV3v:function(e,t,o){"use strict";o.r(t),o.d(t,"_frontmatter",(function(){return a})),o.d(t,"default",(function(){return p}));o("91GP"),o("rGqo"),o("yt8O"),o("Btvt"),o("RW0V"),o("q1tI");var n=o("7ljp"),r=o("013z");o("qKvR");function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}var a={},c={_frontmatter:a},i=r.a;function p(e){var t=e.components,o=function(e,t){if(null==e)return{};var o,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)o=l[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,["components"]);return Object(n.b)(i,l({},c,o,{components:t,mdxType:"MDXLayout"}),Object(n.b)("h2",null,"Background"),Object(n.b)("p",null,"The DataPower Operator uses leader-for-life ",Object(n.b)("a",l({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.6/operators/operator_sdk/osdk-leader-election.html"}),"leader election")," to ensure only one controller pod is active at a time. This relies on Kubernetes garbage collection to clean up the lock when the old operator pod is deleted."),Object(n.b)("h2",null,"Issue"),Object(n.b)("p",null,"When Kubernetes garbage collection is slow, this can lead to an extended period of time in which the new operator pod is not able to obtain the lock, thus preventing it from becoming active and reconciling resources."),Object(n.b)("h2",null,"Symptoms"),Object(n.b)("p",null,"Logs from the ",Object(n.b)("inlineCode",{parentName:"p"},"datapower-operator")," pod will show that the pod is waiting for the lock to be removed:"),Object(n.b)("pre",null,Object(n.b)("code",l({parentName:"pre"},{}),'{"level":"info","ts":"2021-03-08T19:29:53.432Z","logger":"leader","msg":"Not the leader. Waiting."}\n{"level":"info","ts":"2021-03-08T19:29:57.971Z","logger":"leader","msg":"Leader pod has been deleted, waiting for garbage collection to remove the lock."}\n')),Object(n.b)("h2",null,"Solution"),Object(n.b)("p",null,"To resolve this issue, you must manually remove the lock. This can be done by deleting the ",Object(n.b)("inlineCode",{parentName:"p"},"datapower-operator-lock")," ConfigMap in the namespace of the DataPower Operator pod."),Object(n.b)("pre",null,Object(n.b)("code",l({parentName:"pre"},{}),"kubectl delete cm datapower-operator-lock\n")),Object(n.b)("p",null,"Once the lock is removed, the new DataPower Operator pod will begin operation. This can be verified by checking the logs from the operator pod:"),Object(n.b)("pre",null,Object(n.b)("code",l({parentName:"pre"},{}),'{"level":"info","ts":"2021-03-08T20:16:29.974Z","logger":"leader","msg":"No pre-existing lock was found."}\n{"level":"info","ts":"2021-03-08T20:16:30.008Z","logger":"leader","msg":"Became the leader."}\n')))}p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-troubleshooting-operator-lock-mdx-9a51459474b0ddeebd50.js.map