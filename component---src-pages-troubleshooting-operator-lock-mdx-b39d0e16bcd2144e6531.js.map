{"version":3,"sources":["webpack:///./src/pages/troubleshooting/operator-lock.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"yeAMO,IAAMA,EAAe,GAOtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,E,oIACF,mBACD,OAAO,YAACJ,EAAD,KAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,oCACA,oEAAmD,mBAAGC,WAAW,KAAQ,CACrE,KAAQ,uGADuC,mBAAnD,mKAGA,+BACA,iPACA,kCACA,sCAAqB,0BAAYA,WAAW,KAAvB,sBAArB,sEACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,sQAGL,kCACA,mHAAkG,0BAAYA,WAAW,KAAvB,2BAAlG,8DACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,gDAEL,wKACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,iNAOTJ,EAAWK,gBAAiB","file":"component---src-pages-troubleshooting-operator-lock-mdx-b39d0e16bcd2144e6531.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/travis/build/IBM/datapower-operator-doc/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2>{`Background`}</h2>\n    <p>{`The DataPower Operator uses leader-for-life `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.openshift.com/container-platform/4.6/operators/operator_sdk/osdk-leader-election.html\"\n      }}>{`leader election`}</a>{` to ensure only one controller pod is active at a time. This relies on Kubernetes garbage collection to clean up the lock when the old operator pod is deleted.`}</p>\n    <h2>{`Issue`}</h2>\n    <p>{`When Kubernetes garbage collection is slow, this can lead to an extended period of time in which the new operator pod is not able to obtain the lock, thus preventing it from becoming active and reconciling resources.`}</p>\n    <h2>{`Symptoms`}</h2>\n    <p>{`Logs from the `}<inlineCode parentName=\"p\">{`datapower-operator`}</inlineCode>{` pod will show that the pod is waiting for the lock to be removed:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`{\"level\":\"info\",\"ts\":\"2021-03-08T19:29:53.432Z\",\"logger\":\"leader\",\"msg\":\"Not the leader. Waiting.\"}\n{\"level\":\"info\",\"ts\":\"2021-03-08T19:29:57.971Z\",\"logger\":\"leader\",\"msg\":\"Leader pod has been deleted, waiting for garbage collection to remove the lock.\"}\n`}</code></pre>\n    <h2>{`Solution`}</h2>\n    <p>{`To resolve this issue, you must manually remove the lock. This can be done by deleting the `}<inlineCode parentName=\"p\">{`datapower-operator-lock`}</inlineCode>{` ConfigMap in the namespace of the DataPower Operator pod.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`kubectl delete cm datapower-operator-lock\n`}</code></pre>\n    <p>{`Once the lock is removed, the new DataPower Operator pod will begin operation. This can be verified by checking the logs from the operator pod:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`{\"level\":\"info\",\"ts\":\"2021-03-08T20:16:29.974Z\",\"logger\":\"leader\",\"msg\":\"No pre-existing lock was found.\"}\n{\"level\":\"info\",\"ts\":\"2021-03-08T20:16:30.008Z\",\"logger\":\"leader\",\"msg\":\"Became the leader.\"}\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}